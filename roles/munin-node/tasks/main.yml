---
- name: Munin node packages installed
  apt:
    pkg:
      - munin-node
      - munin-plugins-core
      - munin-plugins-extra
      - libwww-perl
      - time
      - libcache-cache-perl
    state: present
    update_cache: false
 
- name: Munin client node conf in place
  copy:
    src: files/munin-node.conf
    dest: /etc/munin/munin-node.conf
    backup: true

- name: Distro set to {{ distro }} in munin apt_all plugin
  lineinfile:
    state: present
    line: "my @releases = ('{{ distro }}');"
    regexp: "^my @releases"
    dest: "/usr/share/munin/plugins/apt_all"

- name: Munin apt_all plugin symlinked
  file:
    src: /usr/share/munin/plugins/apt_all
    dest: /etc/munin/plugins/apt_all
    state: link

- name: Munin node restarted
  service:
    name: munin-node
    state: restarted
